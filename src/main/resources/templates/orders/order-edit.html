<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>–†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è | EROMA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/eroma-clients.css}">
    <script>
        function addProductRow() {
            const table = document.getElementById("productsTable").getElementsByTagName("tbody")[0];
            const row = table.insertRow();

            const cell1 = row.insertCell(0);
            const cell2 = row.insertCell(1);

            cell1.innerHTML = document.getElementById("productSelectTemplate").innerHTML;
            cell2.innerHTML = '<input type="number" name="quantities" class="form-control" required min="1">';
        }
    </script>
</head>
<body class="eroma-bg">

<nav class="navbar fixed-top" style="background-color: rebeccapurple;">
    <div class="container-fluid d-flex justify-content-between align-items-center">
        <a href="/dashboard" class="navbar-brand eroma-title text-white mb-0" style="text-decoration: none;">EROMA</a>
        <ul class="nav">
            <li class="nav-item"><a class="nav-link text-white eroma-link" href="/clients">–ö–ª—ñ—î–Ω—Ç–∏</a></li>
            <li class="nav-item"><a class="nav-link text-white eroma-link" href="/warehouse">–°–∫–ª–∞–¥</a></li>
            <li class="nav-item"><a class="nav-link eroma-link active-link" href="/orders">–û–±–ª—ñ–∫ –∑–∞–º–æ–≤–ª–µ–Ω—å</a></li>
            <li class="nav-item"><a class="nav-link text-white eroma-link" href="/analytics">–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</a></li>
            <li class="nav-item"><a class="nav-link text-white eroma-link" href="/transactions">–¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó</a></li>
            <li class="nav-item"><a class="nav-link text-white eroma-link" href="/logout">–í–∏–π—Ç–∏</a></li>
        </ul>
    </div>
</nav>

<div class="container py-5 mt-5">
    <div class="card eroma-card p-4 shadow eroma-table-wrapper">

        <h4 class="eroma-section">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è ‚Ññ<span th:text="${order.id}"></span></h4>

        <form th:action="@{/orders/edit/{id}(id=${order.id})}" method="post">

            <div class="mb-3">
                <label class="form-label">–ö–ª—ñ—î–Ω—Ç:</label>
                <select name="clientId" class="form-select" required>
                    <option th:each="client : ${clients}"
                            th:value="${client.id}"
                            th:text="${client.name}"
                            th:selected="${client.id == order.client.id}"></option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">–¢–∏–ø –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</label>
                <select name="orderType" class="form-select" required>
                    <option th:each="type : ${orderTypes}"
                            th:value="${type}"
                            th:text="${type}"
                            th:selected="${type == order.orderType}"></option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏:</label>
                <select name="deliveryType" class="form-select" required>
                    <option th:each="type : ${deliveryTypes}"
                            th:value="${type}"
                            th:text="${type.displayName}"
                            th:selected="${type == order.deliveryType}"></option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">–î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:</label>
                <textarea name="additionalInfo" class="form-control"
                          rows="3" th:text="${order.additionalInfo}"> </textarea>
            </div>

            <h5 class="mt-4">üì¶ –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä—ñ–≤</h5>
            <table class="table table-bordered align-middle" id="productsTable">
                <thead class="table-light">
                <tr>
                    <th>–¢–æ–≤–∞—Ä</th>
                    <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${order.items}">
                    <td>
                        <select name="productIds" class="form-select">
                            <option th:each="product : ${products}"
                                    th:value="${product.id}"
                                    th:text="${product.name}"
                                    th:selected="${product.id == item.product.id}"></option>
                        </select>
                    </td>
                    <td><input type="number" name="quantities" class="form-control" min="1"
                               th:value="${item.quantity}"></td>
                </tr>
                </tbody>
            </table>

            <button type="button" class="btn btn-outline-primary mb-3" onclick="addProductRow()">‚ûï –î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</button>

            <div>
                <button type="submit" class="btn btn-success">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
                <a th:href="@{/orders}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥</a>
            </div>
        </form>

        <!-- –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤ -->
        <div id="productSelectTemplate" style="display: none;">
            <select name="productIds" class="form-select">
                <option th:each="product : ${products}" th:value="${product.id}" th:text="${product.name}"></option>
            </select>
        </div>

    </div>
</div>

</body>
</html>
